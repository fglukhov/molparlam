/* CFElement * version: 2.2 * last update: 08.2013 * author: Vadim Zozulja * mail: vadimzw@gmail.com */
function createOptionsList(n){$CFE_select=$(n),$visRows=$CFE_select.find(".CFEselectListContainer").attr("visrows"),$CFE_select.find(".CFEselectListContainer").css({display:"none",visibility:"visible"}),$selectList=$CFE_select.find(".CFEselectList"),$CFEList=$selectList.find(".CFEList"),$selectList.find(".CFEselectListItem").remove(),$CFEscroll=$CFE_select.find(".CFEscroll"),$CFE_select.find("option").each(function(){$(this).is(":selected")?($CFEList.append('<div class="CFEselectListItem CFEselectedItem"><span class="CFEselectListItemText">'+$(this).html()+"</span></div>"),$CFE_select.find(".CFEselectText").html($(this).html())):$CFEList.append('<div class="CFEselectListItem"><span class="CFEselectListItemText">'+$(this).html()+"</span></div>"),$(this).is(":disabled")&&$CFEList.find(".CFEselectListItem:last").addClass("CFEselectListItemDisabled")}),$hiddenBlock=$('<div style="position:absolute; top:-1000px; left:-1000px;"></div>'),$("body").append($hiddenBlock),$selectListClone=$hiddenBlock.append($selectList.clone()),$CFE_select.find("option").size()>$visRows?($listHeight=$selectListClone.find(".CFEselectListItem").innerHeight()*$CFE_select.find("option").size(),$listOverHeight=$selectListClone.find(".CFEselectListItem").innerHeight()*$visRows,$CFEscroll.length==1?($CFEscroll.height($listOverHeight),$scrollWidth=Number($CFEscroll.css("width").replace("px","")),$trackHeight=$listOverHeight-$CFEscroll.find(".CFEarrowUp").height()-$CFEscroll.find(".CFEarrowDown").height(),$CFEscroll.find(".CFEsliderTrack").height($trackHeight).css("top",$CFEscroll.find(".CFEarrowUp").height()),$CFEsliderHeight=$listOverHeight*100/$listHeight,$CFEscroll.find(".CFEslider").height($CFEsliderHeight),$CFEscroll.show()):$scrollWidth=scrollbarWidth(),$selectList.css({height:$listOverHeight,"padding-right":$scrollWidth})):($selectList.css({height:"auto","padding-right":0}),$CFEscroll.hide()),$textWidth=$selectListClone.find(".CFEselectListItemText").innerWidth(),$selectListClone.find(".CFEselectListItemText").each(function(){$textWidth<$(this).innerWidth()&&($textWidth=$(this).innerWidth())}),$textWidth>$CFE_select.width()?$selectList.width($textWidth):$selectList.width("auto"),$hiddenBlock.remove()}function scrollbarWidth(){return $scrollbarOuter=$('<div style="position:absolute; top:-200px; left:-200px; height:50px;"></div>'),$scrollbarInner=$('<div style="width:100px; height:100px;">test</div>'),$scrollbarOuter.append($scrollbarInner),$("body").append($scrollbarOuter),$widht1=$scrollbarOuter.width(),$scrollbarOuter.css("overflow-y","scroll"),$widht2=$scrollbarOuter.width(),$widht2-$widht1==0&&($widht1=$scrollbarOuter[0].clientWidth),$scrollbarOuter.remove(),$widht2-$widht1}function CFEselectEvents(){$(document).unbind("click"),$(document).click(function(n){$(n.target).parents().filter(".CFEselect").length!=1&&($(".CFEselectListContainer").hide(),$("span.CFEselect").removeClass("CFEselect_focus").removeClass("CFEselect_active"),$("span.CFEselect").each(function(){$zIndex=$(this).find("select").css("z-index"),$(this).css("z-index",$zIndex)}))}),$("span.CFEselect").unbind("click"),$("span.CFEselect").click(function(n){if($(this).addClass("CFEselect_focus"),$CFEselect=$(this),!$(this).find("select").is(":disabled")){if($curListContainer=$(this).find(".CFEselectListContainer"),$("span.CFEselect").not($(this)).removeClass("CFEselect_focus"),$(".CFEselectListContainer:visible").not($curListContainer).hide(),$curListContainer.is(":visible")){if($(n.target).parent().hasClass("CFEscroll")||$(n.target).parent().parent().hasClass("CFEscroll"))return;$(this).removeClass("CFEselect_active"),$zIndex=$(this).find("select").css("z-index"),$(this).css("z-index",$zIndex),$curListContainer.hide()}else $curListContainer.show(),$(this).addClass("CFEselect_active"),$topPosition=$(this).offset().top+$(this).height()-$(window).scrollTop(),$windowHeight=$(window).height(),$leftPosition=$(this).offset().left,$windowWidth=$(window).width(),$curWidth=$curListContainer.find(".CFEselectList").outerWidth(),$topPosition+$curListContainer.height()>$windowHeight?($(this).css("z-index","999"),$curListContainer.css({top:"auto",bottom:"100%"}),$leftPosition+$curWidth>$windowWidth&&($(this).css("z-index","999"),$curListContainer.css("left",$curListContainer.width()-$curWidth))):$leftPosition+$curWidth>$windowWidth?($(this).css("z-index","999"),$curListContainer.css("left",$curListContainer.width()-$curWidth),$topPosition+$curListContainer.height()<=$windowHeight&&$curListContainer.css({top:"100%",bottom:"auto"})):($zIndex=$(this).find("select").css("z-index"),$(this).css("z-index",$zIndex),$curListContainer.css({top:"100%",bottom:"auto",left:"0"})),$(this).find(".CFEscroll").length&&scrollEvents($CFEselect);if($(n.target).hasClass("CFEselectListItem")||$(n.target).hasClass("CFEselectListItemText")){if($curItem=$(n.target).hasClass("CFEselectListItem")?$(n.target).find(".CFEselectListItemText"):$(n.target),$curItem.parent().hasClass("CFEselectedItem")||$curItem.parent().hasClass("CFEselectListItemDisabled"))return;$curIndex=$(this).find(".CFEselectListItemText").index($curItem),$(this).find(".CFEselectListItem").filter(".CFEselectedItem").removeClass("CFEselectedItem"),$curItem.parent().addClass("CFEselectedItem"),$curOptions=$(this).find("option"),$curOptions.removeAttr("selected"),$curOptions.eq($curIndex).prop("selected","selected"),$(this).find(".CFEselectText").html($curItem.html()),$(this).find("select").change()}}}),$(".CFEselectListItem").unbind("hover"),$(".CFEselectListItem").hover(function(){$(this).hasClass("CFEselectListItemDisabled")||$(this).addClass("CFEselectListItemHover")},function(){$(this).removeClass("CFEselectListItemHover")}),$("span.CFEselect").unbind("focus"),$("span.CFEselect").unbind("blur"),$("span.CFEselect").focus(function(){$(this).addClass("CFEselect_focus")}).blur(function(){$(this).removeClass("CFEselect_focus"),$(this).find(".CFEselectListContainer:visible").hide()}),$(document).unbind("keydown"),$(document).keydown(function(n){n.keyCode==9&&($("span.CFEselect").not(":focus").find(".CFEselectListContainer:visible").hide(),$("span.CFEselect").not(":focus").removeClass("CFEselect_focus")),n.keyCode==38&&changeSelectedItem(-1),n.keyCode==40&&changeSelectedItem(1)})}function changeSelectedItem(n){$curFocusSelect=$("span.CFEselect").filter(".CFEselect_focus"),$curFocusSelect.length&&($curSelectedItem=$curFocusSelect.find(".CFEselectedItem"),$curSelectedIndex=$curFocusSelect.find(".CFEselectListItem").index($curSelectedItem),$newIndex=$curSelectedIndex+n,$newIndex<=0&&($newIndex=0),$newIndex>=$curFocusSelect.find(".CFEselectListItem").length&&($newIndex=$curFocusSelect.find(".CFEselectListItem").length-1),$curSelectedItem.removeClass("CFEselectedItem"),$newSelectedItem=$curFocusSelect.find(".CFEselectListItem").eq($newIndex),$newSelectedItem.addClass("CFEselectedItem"),$curFocusSelect.find(".CFEselectText").text($newSelectedItem.text()),$curFocusSelect.find("option:selected").removeAttr("selected"),$curFocusSelect.find("option").eq($newIndex).prop("selected","selected"),$curFocusSelect.find("select").change()),$curFocusSelect.find(".CFEselectListContainer").is(":visible")&&scrollEvents($curFocusSelect)}function scrollEvents(n){function t(n){$top=n,$top<=-$maxTop&&($top=-$maxTop),$top>=0&&($top=0),$CFEList.css("top",$top),$temp=$top*100/$maxTop,$sliderTop=-($maxSliderTop*$temp)/100,i()}function i(){$sliderTop>=$maxSliderTop&&($sliderTop=$maxSliderTop),$sliderTop<=0&&($sliderTop=0),$CFEslider.css("top",$sliderTop)}function r(){$CFEselectListItem=$CFE_select.find(".CFEselectedItem"),$curIndex=$CFEList.find(".CFEselectListItem").index($CFEselectListItem),$top=$delta*$curIndex,t(-$top)}$CFE_select=$(n),$CFEList=$CFE_select.find(".CFEList"),$CFEsliderTrack=$CFE_select.find(".CFEsliderTrack"),$CFEslider=$CFE_select.find(".CFEslider"),$CFEarrowUp=$CFE_select.find(".CFEarrowUp"),$CFEarrowDown=$CFE_select.find(".CFEarrowDown"),$delta=$CFE_select.find(".CFEselectListItem").height(),$top=$CFEList.position().top,$maxTop=$CFEList.height()-$CFEList.parent().height(),$maxSliderTop=$CFEsliderTrack.height()-$CFEslider.height(),r(),$CFEslider.unbind("mousedown"),$CFEslider.mousedown(function(n){n.preventDefault(),$startPos=n.pageY,$sliderTop=$CFEslider.position().top,$CFEsliderTrack.mousemove(function(n){$sliderTop+=n.pageY-$startPos,$startPos=n.pageY,i(),$temp=$sliderTop*100/$maxSliderTop,$listTop=$maxTop*$temp/100,t(-$listTop)}),$(document).unbind("mouseup"),$(document).mouseup(function(){$CFEsliderTrack.unbind("mousemove")})}),$CFEarrowUp.unbind("click"),$CFEarrowUp.click(function(){$top+=$delta,t($top)}),$CFEarrowDown.unbind("click"),$CFEarrowDown.click(function(){$top-=$delta,t($top)}),$CFEsliderTrack.unbind("click"),$CFEsliderTrack.click(function(n){$(n.target).hasClass("CFEsliderTrack")&&($sliderTop=n.pageY-$CFEsliderTrack.offset().top-$CFEslider.height()/2,i(),$temp=$sliderTop*100/$maxSliderTop,$listTop=$maxTop*$temp/100,t(-$listTop))}),$(".CFEcustomScroll").unbind("mousewheel"),$(".CFEcustomScroll").bind("mousewheel",function(n,i){n.preventDefault(),typeof $delta!="undefined"&&(i<=-1?($top-=$delta,t($top)):($top+=$delta,t($top)))})}function CFEchkEvents(){$(".CFEcheckbox").unbind("click"),$(".CFEcheckbox").click(function(){$curChk=$(this).find("input"),$curChk.is(":enabled")&&($(this).hasClass("CFEcheckbox_checked")?($(this).removeClass("CFEcheckbox_checked"),$curChk.prop("checked",!1)):($(this).addClass("CFEcheckbox_checked"),$curChk.prop("checked",!0)),$curChk.change())})}function CFEradioEvents(){$(".CFEradio").unbind("click"),$(".CFEradio").click(function(){if($curRadio=$(this).find("input"),$curRadio.is(":enabled")){if($curName=$(this).attr("name"),$radioList=$(".CFEradio").filter("[name="+$curName+"]"),$radioChecked=$radioList.filter(".CFEradio_checked"),$(this).hasClass("CFEradio_checked"))return;$radioChecked.removeClass("CFEradio_checked"),$radioChecked.find("input").prop("checked",!1),$(this).addClass("CFEradio_checked"),$(this).find("input").prop("checked",!0),$curRadio.change()}})}jQuery.fn.CFElement=function(n){function r(n){$elem=$(n),$elem.is("select")&&(u($elem),$selectCounter++),$elem.is("input:checkbox")&&(t($elem),$chkCounter++),$elem.is("input:radio")&&i($elem)}function u(t){$num=$selectCounter,$class="CFEselect",$disabled="",$zindex=$allElem-$elemCounter,$visRows=n.selectvisibleRows,$scrollWidht=0,$tabindex=$(t).prop("tabindex"),$id=$(t).attr("id")?"CFE-"+$(t).attr("id"):"CFEselect"+$num,$(t).is(":disabled")&&($disabled=' disabled="disabled"',$class="CFEselect CFEselect_disabled"),n.customScroll?($CFEscroll=n.showArrows?'<div class="CFEscroll"><div class="CFEsliderTrack"><div class="CFEslider"><span class="CFEslider_t"></span><span class="CFEslider_b"></span></div></div><div class="CFEarrowUp"></div><div class="CFEarrowDown"></div></div>':'<div class="CFEscroll"><div class="CFEsliderTrack"><div class="CFEslider"><span class="CFEslider_t"></span><span class="CFEslider_b"></span></div></div></div>',$listClass="CFEselectList CFEcustomScroll"):($listClass="CFEselectList",$CFEscroll=""),$elemParent=$(t).parent(),$elemParent.hasClass("CFEselect")&&($elemParent.after($(t)),$elemParent.remove()),$(t).css("z-index",$zindex),$(t).wrap('<span id="'+$id+'" class="'+$class+'" tabindex="'+$tabindex+'"'+$disabled+' style="z-index:'+$zindex+'"></span>').hide().after('<span class="CFEselect_lItem"></span><span class="CFEselectTextItem"><span class="CFEselectText"></span></span><span class="CFEselect_rItem"></span><div class="CFEselectListContainer" visrows="'+$visRows+'"><div class="'+$listClass+'">'+$CFEscroll+'<div class="CFEList"></div></div></div>'),$CFE_select=$(t).parent(),$CFE_select.css("z-index",$zindex),$CFE_select.width(Number($(t).css("width").replace("px",""))),$textWidht=$CFE_select.width()-$CFE_select.find(".CFEselect_lItem").width()-$CFE_select.find(".CFEselect_rItem").width(),$CFE_select.find(".CFEselectText").width($textWidht),createOptionsList($CFE_select)}function t(n){$num=$chkCounter,$class="CFEcheckbox",$zindex=$allElem-$elemCounter,$tabindex=$(n).attr("tabindex"),$id=$(n).attr("id")?"CFE-"+$(n).attr("id"):"CFEcheckbox"+$num,$(n).css("z-index",$zindex),$(n).wrap('<span id="'+$id+'" class="'+$class+'" tabindex="'+$tabindex+'" style="z-index:'+$zindex+'"></span>').hide(),$(n).is(":checked")&&$(n).parent().addClass("CFEcheckbox_checked"),$(n).is(":disabled")&&($(n).parent().attr("disabled","disabled"),$(n).parent().addClass("CFEcheckbox_disabled"))}function i(n){$class="CFEradio",$name="CFEradio"+$(n).attr("name"),$zindex=$allElem-$elemCounter,$tabindex=$(n).attr("tabindex"),$(n).css("z-index",$zindex),$(n).wrap('<span class="'+$class+'" tabindex="'+$tabindex+'" style="z-index:'+$zindex+'" name="'+$name+'"></span>').hide(),$(n).is(":checked")&&$(n).parent().addClass("CFEradio_checked"),$(n).is(":disabled")&&($(n).parent().attr("disabled","disabled"),$(n).parent().addClass("CFEradio_disabled"))}var n=jQuery.extend({customScroll:!1,showArrows:!1,selectvisibleRows:5},n);return $allElem=$(this).length,$elemCounter=0,$selectCounter=0,$chkCounter=0,this.each(function(n){r(this),n++,$elemCounter=n,n==$allElem&&($("select").length!=0&&CFEselectEvents(),$("input:checkbox").length!=0&&CFEchkEvents(),$("input:radio").length!=0&&CFEradioEvents())})},jQuery.fn.CFEchangeDisabled=function(){$(this).is(":disabled")?($(this).is("select")&&$(this).parent().addClass("CFEselect_disabled").attr("disabled",!0),$(this).is("input:checkbox")&&$(this).parent().addClass("CFEcheckbox_disabled").attr("disabled",!0),$(this).is("input:radio")&&$(this).parent().addClass("CFEradio_disabled").attr("disabled",!0)):($(this).is("select")&&$(this).parent().removeClass("CFEselect_disabled").attr("disabled",!1),$(this).is("input:checkbox")&&$(this).parent().removeClass("CFEcheckbox_disabled").attr("disabled",!1),$(this).is("input:radio")&&$(this).parent().removeClass("CFEradio_disabled").attr("disabled",!1))},jQuery.fn.CFErefresh=function(){$CFE_select=$(this).parent(),$CFE_select.find(".CFEselectListContainer").css({display:"block",visibility:"hidden"}),createOptionsList($CFE_select),CFEselectEvents()};